<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Find the right SF Tech Week events</title>
    <style>
      * { box-sizing: border-box; }
      
      body { 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; 
        margin: 0; 
        background: linear-gradient(135deg, #1a1f15 0%, #2c3424 100%);
        color: #daded8; 
        min-height: 100vh;
        line-height: 1.6;
      }
      
      .wrap { 
        max-width: 900px; 
        margin: 0 auto; 
        padding: 40px 24px; 
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      
      .header {
        margin-bottom: 40px;
      }
      
      .logo-link {
        text-decoration: none;
        color: inherit;
        transition: all 0.3s ease;
      }
      
      .logo-link:hover {
        transform: scale(1.02);
      }
      
      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .logo-img {
        height: 40px;
        width: auto;
      }
      
      .logo-text {
        font-size: 24px;
        font-weight: 700;
        color: #daded8;
        letter-spacing: 2px;
      }
      
      .footer {
        margin-top: 60px;
        text-align: center;
        padding: 20px 0;
        border-top: 1px solid rgba(218, 222, 216, 0.2);
      }
      
      .footer p {
        color: rgba(218, 222, 216, 0.7);
        font-size: 14px;
        margin: 0;
      }
      
      .shezaar-link {
        color: #daded8;
        text-decoration: none;
        font-weight: 600;
        border-bottom: 1px solid transparent;
        transition: all 0.3s ease;
      }
      
      .shezaar-link:hover {
        border-bottom-color: #daded8;
        color: #daded8;
      }
      
      .card { 
        background: rgba(76, 88, 62, 0.3); 
        backdrop-filter: blur(20px);
        border: 1px solid rgba(218, 222, 216, 0.2); 
        border-radius: 20px; 
        padding: 32px; 
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
      }
      
      .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
      }
      
      h1 { 
        font-size: 28px; 
        margin: 0 0 16px; 
        color: #daded8;
        font-weight: 700;
      }
      
      .subtitle {
        color: rgba(218, 222, 216, 0.8);
        font-size: 16px;
        margin-bottom: 24px;
        line-height: 1.5;
      }
      
      textarea { 
        width: 100%; 
        min-height: 140px; 
        border-radius: 12px; 
        border: 2px solid rgba(218, 222, 216, 0.3); 
        background: rgba(44, 52, 36, 0.6); 
        color: #daded8; 
        padding: 16px; 
        resize: vertical; 
        font-size: 16px;
        font-family: inherit;
        transition: all 0.3s ease;
        outline: none;
      }
      
      textarea:focus {
        border-color: #daded8;
        box-shadow: 0 0 0 3px rgba(218, 222, 216, 0.2);
        background: rgba(44, 52, 36, 0.8);
      }
      
      textarea::placeholder {
        color: rgba(218, 222, 216, 0.6);
      }
      
      .row { 
        display: flex; 
        gap: 12px; 
        align-items: center; 
        margin-top: 20px; 
        flex-wrap: wrap;
      }
      
      button { 
        margin-bottom: 2rem;
        color: #2c3424;
        text-decoration: none;
        padding: 10px 20px;
        border: 2px solid #2c3424;
        border-radius: 8px;
        transition: all 0.3s ease;
        background: #daded8; 
        padding: 14px 28px;  
        cursor: pointer; 
        font-size: 16px;
        font-weight: 600;
        box-shadow: 0 8px 25px rgba(218, 222, 216, 0.3), 0 0 0 1px rgba(218, 222, 216, 0.1);
        position: relative;
        overflow: hidden;
      }
      
      button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: #daded8;
        transition: left 0.5s;
      }
      
      button:hover:not([disabled]) {
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 12px 35px rgba(218, 222, 216, 0.4), 0 0 0 1px rgba(218, 222, 216, 0.2);
        background: #daded8;
      }
      
      button:hover:not([disabled])::before {
        left: 100%;
      }
      
      button:active:not([disabled]) {
        transform: translateY(-1px) scale(1.01);
        box-shadow: 0 6px 20px rgba(218, 222, 216, 0.3);
      }
      
      button[disabled] { 
        opacity: 0.6; 
        cursor: not-allowed;
        transform: none;
      }
      
      .status {
        color: rgba(218, 222, 216, 0.8);
        font-size: 14px;
        font-style: italic;
      }
      
      .results { 
        margin-top: 32px; 
        animation: fadeIn 0.5s ease;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      .event { 
        padding: 20px; 
        border-bottom: 1px solid rgba(218, 222, 216, 0.2); 
        transition: all 0.3s ease;
        border-radius: 8px;
        margin-bottom: 8px;
        background: rgba(76, 88, 62, 0.2);
      }
      
      .event:hover {
        background: rgba(76, 88, 62, 0.4);
        transform: translateX(4px);
      }
      
      .event:last-child { 
        border-bottom: 0; 
        margin-bottom: 0;
      }
      
      .event-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 8px;
        color: #daded8;
      }
      
      .event-meta {
        color: rgba(218, 222, 216, 0.8);
        font-size: 14px;
        margin-bottom: 6px;
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }
      
      .event-description {
        color: rgba(218, 222, 216, 0.8);
        font-size: 14px;
        margin-bottom: 12px;
        line-height: 1.5;
        font-style: italic;
      }
      
      .event-host {
        color: rgba(218, 222, 216, 0.9);
        font-size: 14px;
        margin-bottom: 12px;
      }
      
      .event-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-bottom: 12px;
      }
      
      .tag {
        background: rgba(218, 222, 216, 0.1);
        color: rgba(218, 222, 216, 0.9);
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
        border: 1px solid rgba(218, 222, 216, 0.2);
      }
      
      .event-link {
        color: #daded8;
        text-decoration: none;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: all 0.3s ease;
        border-bottom: 1px solid transparent;
      }
      
      .event-link:hover {
        color: #daded8;
        border-bottom-color: #daded8;
        transform: translateX(2px);
      }
      
      .prefs-display {
        background: rgba(76, 88, 62, 0.3);
        border: 1px solid rgba(218, 222, 216, 0.2);
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 20px;
        font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        font-size: 13px;
        color: rgba(218, 222, 216, 0.8);
        overflow-x: auto;
      }
      
      .small { 
        color: rgba(218, 222, 216, 0.8); 
        font-size: 14px; 
      }
      
      .mono { 
        font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace; 
      }
      
      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid rgba(218, 222, 216, 0.3);
        border-radius: 50%;
        border-top-color: #daded8;
        animation: spin 1s ease-in-out infinite;
      }
      
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      .error {
        background: rgba(218, 222, 216, 0.1);
        border: 1px solid rgba(218, 222, 216, 0.3);
        color: #daded8;
        padding: 12px;
        border-radius: 8px;
        margin-top: 16px;
      }
      
      
      .clear-filters-btn {
        background: rgba(218, 222, 216, 0.1);
        color: rgba(218, 222, 216, 0.9);
        border: 1px solid rgba(218, 222, 216, 0.25);
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(5px);
        height: fit-content;
        align-self: flex-end;
      }
      
      .clear-filters-btn:hover {
        background: rgba(76, 136, 76, 0.2);
        color: #2c3424;
        border-color: rgba(76, 136, 76, 0.4);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(76, 136, 76, 0.2);
      }
      
      .clear-filters-btn:active {
        color: #2c3424;
        background: rgba(76, 136, 76, 0.3);
        transform: translateY(0);
      }
      
      .filters-row {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        align-items: flex-end;
        margin-bottom: 28px;
        padding: 20px 0;
      }
      
      .filter-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
        min-width: 150px;
      }
      
      .filter-group label {
        font-size: 14px;
        color: rgba(218, 222, 216, 0.9);
        font-weight: 500;
      }
      
      .filter-select {
        background: rgba(44, 52, 36, 0.7);
        backdrop-filter: blur(5px);
        border: 1px solid rgba(218, 222, 216, 0.2);
        color: #daded8;
        padding: 10px 16px;
        border-radius: 10px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      
      .filter-select:hover {
        border-color: rgba(218, 222, 216, 0.4);
        background: rgba(44, 52, 36, 0.8);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
      
      .filter-select:focus {
        outline: none;
        border-color: #daded8;
        background: rgba(44, 52, 36, 0.9);
        box-shadow: 0 0 0 3px rgba(218, 222, 216, 0.2), 0 4px 12px rgba(0, 0, 0, 0.15);
      }
      
      /* Multi-select styling */
      .multi-select-container {
        position: relative;
        width: 100%;
      }
      
      .multi-select-display {
        background: rgba(44, 52, 36, 0.8);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(218, 222, 216, 0.25);
        color: #daded8;
        padding: 14px 18px;
        border-radius: 10px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        position: relative;
        min-height: 24px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-weight: 500;
      }
      
      .multi-select-display::after {
        content: '▼';
        font-size: 12px;
        color: rgba(218, 222, 216, 0.7);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: bold;
      }
      
      .multi-select-display.open::after {
        transform: rotate(180deg);
        color: #daded8;
      }
      
      .multi-select-display:hover {
        border-color: rgba(218, 222, 216, 0.5);
        background: rgba(44, 52, 36, 0.9);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      }
      
      .multi-select-display:hover::after {
        color: #daded8;
        transform: scale(1.1);
      }
      
      .multi-select-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: rgba(44, 52, 36, 0.98);
        backdrop-filter: blur(15px);
        border: 1px solid rgba(218, 222, 216, 0.25);
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(218, 222, 216, 0.1);
        z-index: 1000;
        max-height: 280px;
        overflow-y: auto;
        display: none;
        margin-top: 8px;
        padding: 8px 0;
      }
      
      .multi-select-dropdown::-webkit-scrollbar {
        width: 6px;
      }
      
      .multi-select-dropdown::-webkit-scrollbar-track {
        background: rgba(218, 222, 216, 0.1);
        border-radius: 3px;
      }
      
      .multi-select-dropdown::-webkit-scrollbar-thumb {
        background: rgba(218, 222, 216, 0.3);
        border-radius: 3px;
        transition: background 0.3s ease;
      }
      
      .multi-select-dropdown::-webkit-scrollbar-thumb:hover {
        background: rgba(218, 222, 216, 0.5);
      }
      
      .multi-select-dropdown.show {
        display: block;
        animation: fadeInDown 0.3s ease;
      }
      
      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      .multi-select-option {
        padding: 16px 20px;
        color: #daded8;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-bottom: 1px solid rgba(218, 222, 216, 0.08);
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 14px;
        position: relative;
        border-radius: 8px;
        margin: 4px 8px;
        min-height: 48px;
      }
      
      .multi-select-option:last-child {
        border-bottom: none;
      }
      
      .multi-select-option:hover {
        background: rgba(218, 222, 216, 0.15);
        color: #daded8;
        transform: translateX(4px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      
      .multi-select-option.selected {
        background: rgba(218, 222, 216, 0.15);
        color: #daded8;
        font-weight: 600;
        transform: translateX(6px);
        box-shadow: 0 4px 12px rgba(218, 222, 216, 0.2);
        text-shadow: 0 0 8px rgba(218, 222, 216, 0.4);
      }
      
      .multi-select-option::before {
        content: '';
        font-size: 16px;
        color: transparent;
        transition: all 0.3s ease;
        width: 18px;
        height: 18px;
        min-width: 18px;
        min-height: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid #ffffff;
        border-radius: 3px;
        background: transparent;
        flex-shrink: 0;
        box-sizing: border-box;
      }
      
      .multi-select-option.selected::before {
        content: '✓';
        color: #daded8;
        background: rgba(218, 222, 216, 0.1);
        border: 2px solid rgba(218, 222, 216, 0.6);
        font-weight: bold;
        font-size: 12px;
        text-shadow: 0 0 8px rgba(218, 222, 216, 0.6);
      }
      
      .multi-select-option:hover::before {
        border: 2px solid rgba(218, 222, 216, 0.3);
        background: rgba(218, 222, 216, 0.05);
        transform: scale(1.05);
      }
      
      .multi-select-option.selected:hover::before {
        transform: scale(1.05);
        text-shadow: 0 0 12px rgba(218, 222, 216, 0.8);
      }
      
      .results-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 12px;
        border-bottom: 1px solid rgba(218, 222, 216, 0.2);
      }
      
      .results-title-container {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      
      .results-header h3 {
        margin: 0;
        font-size: 20px;
        color: #daded8;
      }
      
      .event-count {
        font-size: 14px;
        color: rgba(218, 222, 216, 0.7);
        font-weight: 500;
        font-style: italic;
      }
      
      .sort-container {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .sort-container label {
        font-size: 14px;
        color: rgba(218, 222, 216, 0.9);
        font-weight: 500;
      }
      
      .sort-select {
        background: rgba(44, 52, 36, 0.6);
        border: 1px solid rgba(218, 222, 216, 0.3);
        color: #daded8;
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      
      .sort-select:focus {
        outline: none;
        border-color: #daded8;
        background: rgba(44, 52, 36, 0.8);
      }
      
      .ai-reasoning {
        background: rgba(76, 88, 62, 0.3);
        border: 1px solid rgba(218, 222, 216, 0.2);
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 20px;
        font-size: 14px;
      }
      
      
      .ai-reasoning .reasoning-content {
        color: rgba(218, 222, 216, 0.9);
        line-height: 1.5;
      }
      
      .event-reason {
        background: rgba(218, 222, 216, 0.1);
        border-left: 3px solid rgba(218, 222, 216, 0.3);
        padding: 8px 12px;
        margin: 8px 0;
        border-radius: 4px;
        font-style: italic;
        font-size: 13px;
      }
      
      .overall-analysis {
        margin-bottom: 20px;
        padding: 15px;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 8px;
        border-left: 4px solid #6c757d;
      }
      
      .relevance-suggestions {
        margin-bottom: 20px;
        padding: 15px;
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        border-radius: 8px;
        border-left: 4px solid #2196f3;
      }
      
      .relevance-details {
        margin-top: 10px;
      }
      
      .ranking-rationale, .primary-criteria, .secondary-criteria {
        margin: 8px 0;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 6px;
        font-size: 14px;
      }
      
      .primary-criteria {
        border-left: 3px solid #4caf50;
      }
      
      .secondary-criteria {
        border-left: 3px solid #ff9800;
      }
      
      .event-specific-reasoning {
        margin-top: 15px;
      }
      
      .event-reason {
        margin: 12px 0;
        padding: 15px;
        background: rgba(218, 222, 216, 0.1);
        border-radius: 8px;
        border-left: 3px solid #daded8;
        transition: all 0.3s ease;
      }
      
      .event-reason:hover {
        background: rgba(218, 222, 216, 0.2);
        transform: translateX(2px);
      }
      
      .event-name {
        margin-bottom: 8px;
        color: #2c3424;
        font-size: 16px;
      }
      
      .event-explanation {
        color: #555;
        line-height: 1.5;
        font-size: 14px;
      }
      
      .floating-outfit-btn {
        position: fixed !important;
        bottom: 20px !important;
        right: 20px !important;
        border-radius: 50px !important;
        padding: 14px 24px !important;
        z-index: 1000 !important;
        animation: floatIn 0.5s ease-out;
        max-width: calc(100vw - 40px);
        box-sizing: border-box;
        pointer-events: auto !important;
      }
      
      .floating-outfit-btn:hover {
        transform: translateY(-4px) scale(1.05) !important;
      }
      
      .floating-outfit-btn:active {
        transform: translateY(-2px) scale(1.02) !important;
      }
      
      @keyframes floatIn {
        from {
          opacity: 0;
          transform: translateY(20px) scale(0.8);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      
      /* Outfit Recommendation Modal */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(26, 31, 21, 0.8) 0%, rgba(44, 52, 36, 0.8) 100%);
        backdrop-filter: blur(15px) saturate(1.2);
        z-index: 2000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        opacity: 0;
        visibility: hidden;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      .modal-overlay.show {
        opacity: 1;
        visibility: visible;
      }
      
      .modal-content {
        background: rgba(76, 88, 62, 0.85);
        backdrop-filter: blur(25px) saturate(1.1);
        border: 1px solid rgba(218, 222, 216, 0.25);
        border-radius: 24px;
        padding: 32px;
        max-width: 600px;
        width: 100%;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(218, 222, 216, 0.1);
        transform: translateY(20px) scale(0.95);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      .modal-overlay.show .modal-content {
        transform: translateY(0) scale(1);
      }
      
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 1px solid rgba(218, 222, 216, 0.2);
      }
      
      .modal-title {
        font-size: 24px;
        font-weight: 700;
        color: #daded8;
        margin: 0;
      }
      
      .modal-close {
        font-size: 24px !important;
        padding: 8px !important;
        border-radius: 8px !important;
        width: 40px !important;
        height: 40px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        min-width: 40px !important;
      }
      
      .outfit-recommendation {
        background: rgba(44, 52, 36, 0.6);
        border: 1px solid rgba(218, 222, 216, 0.2);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
      }
      
      .outfit-recommendation h4 {
        margin: 0 0 12px 0;
        color: #daded8;
        font-size: 18px;
      }
      
      .outfit-recommendation p {
        margin: 0 0 16px 0;
        color: rgba(218, 222, 216, 0.9);
        line-height: 1.6;
      }
      
      .outfit-recommendation p:last-child {
        margin-bottom: 0;
      }

      
      .event-types {
        background: rgba(218, 222, 216, 0.1);
        border: 1px solid rgba(218, 222, 216, 0.2);
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 20px;
      }
      
      .event-types h5 {
        margin: 0 0 8px 0;
        color: #daded8;
        font-size: 14px;
        font-weight: 600;
      }
      
      .event-types .tags {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }
      
      .event-types .tag {
        background: rgba(218, 222, 216, 0.2);
        color: rgba(218, 222, 216, 0.9);
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
        border: 1px solid rgba(218, 222, 216, 0.3);
      }
      
      .modal-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 24px;
        padding-top: 16px;
        border-top: 1px solid rgba(218, 222, 216, 0.2);
      }
      
      .modal-btn {
        background: #daded8;
        color: #2c3424;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 6px 20px rgba(218, 222, 216, 0.3), 0 0 0 1px rgba(218, 222, 216, 0.1);
        position: relative;
        overflow: hidden;
      }
      
      .modal-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: #daded8;
        transition: left 0.5s;
      }
      
      .modal-btn:hover {
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 8px 25px rgba(74, 93, 35, 0.4), 0 0 0 1px rgba(74, 93, 35, 0.2);
        background: #daded8;
        color: #2c3424;
      }
      
      .modal-btn:hover::before {
        left: 100%;
      }
      
      .modal-btn:active {
        transform: translateY(-1px) scale(1.01);
        background: #2c3424;
        color: #daded8;
        box-shadow: 0 4px 15px rgba(74, 93, 35, 0.5), 0 0 0 1px rgba(74, 93, 35, 0.3);
      }
      
      .modal-btn.secondary {
        background: transparent;
        color: #daded8;
        padding: 10px 20px;
        border: 2px solid #daded8;
        box-shadow: none;
        border-radius: 8px;
        transition: all 0.3s ease;
      }
      
      .modal-btn.secondary:hover {
        background: #daded8;
        color: #2c3424;
        transform: translateY(-1px) scale(1.01);
        box-shadow: 0 4px 15px rgba(74, 93, 35, 0.3);
      }

      .modal-btn.secondary:active {
        background: #daded8;
        color: #2c3424;
        transform: translateY(-1px) scale(1.01);
        box-shadow: 0 4px 15px rgba(74, 93, 35, 0.3);
      }


      .modal-btn.underlined {
        text-decoration: underline;
        text-underline-offset: 4px;
        text-decoration-color: #daded8;
        text-decoration-thickness: 2px;
      }

      .modal-btn.underlined:hover {
        text-decoration-color: #daded8;
        transform: translateY(-1px) scale(1.01);
      }

      .modal-btn.underlined:active {
        text-decoration-color: #daded8;
      }

      /* Standardized Button Styles */
      .btn {
        border: none;
        padding: 12px 24px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        white-space: nowrap;
      }

      .btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: #daded8;
        transition: left 0.5s;
      }

      .btn:hover::before {
        left: 100%;
      }

      .btn.primary {
        margin-bottom: 2rem;
        text-decoration: none;
        padding: 10px 20px;
        border: 2px solid #daded8;
        border-radius: 8px;
        transition: all 0.3s ease;
        background: #daded8;
        color: #2c3424;
        box-shadow: 0 6px 20px rgba(218, 222, 216, 0.3), 0 0 0 1px rgba(218, 222, 216, 0.1);
      }

      .btn.primary:hover {
        background: #daded8;
        color: #2c3424;
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 8px 25px rgba(74, 93, 35, 0.4), 0 0 0 1px rgba(74, 93, 35, 0.2);
      }

      .btn.primary:active {
        transform: translateY(-1px) scale(1.01);
        background: #daded8;
        color: #2c3424;
        box-shadow: 0 4px 15px rgba(74, 93, 35, 0.5), 0 0 0 1px rgba(74, 93, 35, 0.3);
      }

      .btn.secondary {
        background: transparent;
        margin-bottom: 2rem;
        color: #daded8;
        text-decoration: none;
        padding: 10px 20px;
        border: 2px solid #daded8;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .btn.secondary:hover {
        background: #daded8;
        color: #2c3424;
        border-color: #daded8;
        transform: translateY(-1px) scale(1.01);
        box-shadow: 0 4px 15px rgba(74, 93, 35, 0.3);
      }

      .btn.secondary:active {
        background: #daded8;
        color: #2c3424;
        transform: translateY(0) scale(1);
        box-shadow: 0 2px 8px rgba(74, 93, 35, 0.4);
      }

      .btn.tertiary {
        background: transparent;
        color: rgba(218, 222, 216, 0.8);
        text-decoration: underline;
        text-underline-offset: 4px;
        text-decoration-color: rgba(218, 222, 216, 0.6);
        text-decoration-thickness: 2px;
        box-shadow: none;
        border: none;
      }

      .btn.tertiary:hover {
        background: transparent;
        border: none;
        box-shadow: none;
        color: rgba(218, 222, 216, 0.8);
        text-decoration: underline;
        transform: translateY(-2px) scale(1.02);
      }

      .btn.tertiary:active {
        text-decoration-color: #daded8;
      }
      
      /* Gender Selection Styles */
      .gender-selection {
        text-align: center;
        padding: 20px 0;
      }
      
      .gender-selection h4 {
        margin: 0 0 24px 0;
        color: #daded8;
        font-size: 18px;
        font-weight: 600;
      }
      
      .gender-options {
        display: flex;
        gap: 16px;
        justify-content: center;
        flex-wrap: wrap;
      }
      
      .gender-btn {
        background: rgba(218, 222, 216, 0.1);
        color: #daded8;
        border: 2px solid rgba(218, 222, 216, 0.25);
        padding: 12px 24px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        min-width: 140px;
        backdrop-filter: blur(5px);
        position: relative;
        overflow: hidden;
      }
      
      .gender-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: #2c3424;
        transition: left 0.5s;
      }
      
      .gender-btn:hover {
        background: rgba(218, 222, 216, 0.2);
        border-color: rgba(218, 222, 216, 0.5);
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      }
      
      .gender-btn:hover::before {
        left: 100%;
      }
      
      .gender-btn.selected {
        background: #daded8;
        color: #2c3424;
        border-color: #daded8;
        box-shadow: 0 6px 20px rgba(218, 222, 216, 0.3);
      }
      
      /* Products Display Styles */
      .products-content {
        background: rgba(44, 52, 36, 0.6);
        border: 1px solid rgba(218, 222, 216, 0.2);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
      }
      
      .products-content h4 {
        margin: 0 0 16px 0;
        color: #daded8;
        font-size: 18px;
      }
      
      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 16px;
        margin-top: 16px;
      }
      
      .product-item {
        background: rgba(76, 88, 62, 0.3);
        border: 1px solid rgba(218, 222, 216, 0.2);
        border-radius: 8px;
        padding: 16px;
        text-align: center;
        transition: all 0.3s ease;
      }
      
      .product-item:hover {
        background: rgba(76, 88, 62, 0.5);
        transform: translateY(-2px);
      }
      
      .product-name {
        font-weight: 600;
        color: #daded8;
        margin-bottom: 8px;
        font-size: 14px;
      }
      
      .product-price {
        color: rgba(218, 222, 216, 0.8);
        font-size: 13px;
        margin-bottom: 8px;
      }
      
      .product-link {
        color: #daded8;
        text-decoration: none;
        font-size: 12px;
        font-weight: 500;
        border-bottom: 1px solid transparent;
        transition: all 0.3s ease;
      }
      
      .product-link:hover {
        border-bottom-color: #daded8;
      }
      
      .no-products {
        text-align: center;
        color: rgba(218, 222, 216, 0.8);
        font-style: italic;
        padding: 20px;
      }

      /* Outfit Tabs Styles */
      .outfit-tabs-container {
        margin-top: 20px;
      }

      .outfit-tabs-navigation {
        display: flex;
        gap: 8px;
        margin-bottom: 20px;
        border-bottom: 1px solid rgba(218, 222, 216, 0.2);
        padding-bottom: 8px;
        flex-wrap: wrap;
      }

      .outfit-tab {
        background: rgba(218, 222, 216, 0.1);
        color: rgba(218, 222, 216, 0.8);
        border: 1px solid rgba(218, 222, 216, 0.2);
        padding: 10px 16px;
        border-radius: 8px 8px 0 0;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        white-space: nowrap;
        min-width: 120px;
        text-align: center;
      }

      .outfit-tab::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: rgba(218, 222, 216, 0.1);
        transition: left 0.5s;
      }

      .outfit-tab:hover {
        background: rgba(218, 222, 216, 0.2);
        border-color: rgba(218, 222, 216, 0.4);
        color: #daded8;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .outfit-tab:hover::before {
        left: 100%;
      }

      .outfit-tab.active {
        background: rgba(218, 222, 216, 0.2);
        color: #daded8;
        border-color: rgba(218, 222, 216, 0.5);
        border-bottom-color: rgba(76, 88, 62, 0.85);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        font-weight: 600;
      }

      .outfit-tab.active::before {
        background: rgba(218, 222, 216, 0.15);
      }

      .outfit-tabs-content {
        position: relative;
        min-height: 200px;
      }

      .outfit-tab-content {
        display: none;
        animation: fadeIn 0.3s ease;
      }

      .outfit-tab-content.active {
        display: block;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* Mobile responsiveness for tabs */
      @media (max-width: 768px) {
        .outfit-tabs-navigation {
          flex-direction: column;
          gap: 4px;
        }

        .outfit-tab {
          min-width: auto;
          width: 100%;
          border-radius: 8px;
          margin-bottom: 4px;
        }

        .outfit-tab.active {
          border-bottom-color: rgba(218, 222, 216, 0.5);
        }
      }

      @media (max-width: 768px) {
        .wrap { padding: 20px 16px; }
        .card { padding: 24px; }
        h1 { font-size: 24px; }
        .row { flex-direction: column; align-items: stretch; }
        .logo-img { height: 32px; }
        .logo-text { font-size: 20px; }
        .footer { margin-top: 40px; }
        
        .filters-row {
          flex-direction: column;
          gap: 16px;
        }
        
        .filter-group {
          min-width: auto;
        }
        
        .results-header {
          flex-direction: column;
          gap: 12px;
          align-items: flex-start;
        }
        
        .sort-container {
          width: 100%;
          justify-content: space-between;
        }
        
        .floating-outfit-btn {
          bottom: 16px !important;
          right: 16px !important;
          padding: 12px 18px;
          font-size: 13px;
          border-radius: 40px;
          max-width: calc(100vw - 32px);
        }
        
        .modal-content {
          padding: 24px;
          margin: 10px;
        }
        
        .modal-title {
          font-size: 20px;
        }
        
        .modal-actions {
          flex-direction: column;
        }
        
        .modal-btn {
          width: 100%;
        }
      }
      
      /* Extra small screens */
      @media (max-width: 480px) {
        .floating-outfit-btn {
          bottom: 12px !important;
          right: 12px !important;
          padding: 10px 16px;
          font-size: 12px;
          border-radius: 35px;
          max-width: calc(100vw - 24px);
        }
      }
      
      /* Very small screens */
      @media (max-width: 360px) {
        .floating-outfit-btn {
          bottom: 10px !important;
          right: 10px !important;
          padding: 8px 14px;
          font-size: 11px;
          border-radius: 30px;
          max-width: calc(100vw - 20px);
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header class="header">
        <a href="https://www.shezaar.com" target="_blank" rel="noopener" class="logo-link">
          <div class="logo">
            <img src="./shezaar-logo.png" alt="Shezaar" class="logo-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <div class="logo-text" style="display: none;">SHEZAAR</div>
          </div>
        </a>
      </header>
      
      <div class="card">
        <h1>Find Your Perfect SF Tech Week Events</h1>
        <p class="subtitle">Tell us about your goals and we'll recommend the most relevant events for you. Whether you're looking for investors, co-founders, talent, or just want to network with like-minded people.</p>
        <textarea id="input" placeholder="I am building a wellness tech platform. I want to attend events to meet angels and other co-founders. No preference for time or days."></textarea>
        <div class="row">
          <button id="go" class="btn primary">Find Events</button>
          <span id="status" class="status"></span>
        </div>
      </div>

      <div id="out" class="card results" hidden>
        <div class="filters-row" id="filters" hidden>
          <div class="filter-group">
            <label>Day</label>
            <div class="multi-select-container">
              <div class="multi-select-display" id="day-display">All Days</div>
              <div class="multi-select-dropdown" id="day-dropdown">
                <div class="multi-select-option" data-value="Monday">Monday</div>
                <div class="multi-select-option" data-value="Tuesday">Tuesday</div>
                <div class="multi-select-option" data-value="Wednesday">Wednesday</div>
                <div class="multi-select-option" data-value="Thursday">Thursday</div>
                <div class="multi-select-option" data-value="Friday">Friday</div>
                <div class="multi-select-option" data-value="Saturday">Saturday</div>
                <div class="multi-select-option" data-value="Sunday">Sunday</div>
              </div>
            </div>
          </div>
          <div class="filter-group">
            <label>Location</label>
            <div class="multi-select-container">
              <div class="multi-select-display" id="location-display">All Locations</div>
              <div class="multi-select-dropdown" id="location-dropdown">
                <!-- Options will be populated by JavaScript -->
              </div>
            </div>
          </div>
          <div class="filter-group">
            <label>Industry</label>
            <div class="multi-select-container">
              <div class="multi-select-display" id="industry-display">All Industries</div>
              <div class="multi-select-dropdown" id="industry-dropdown">
                <!-- Options will be populated by JavaScript -->
              </div>
            </div>
          </div>
          <div class="filter-group">
            <label>Type</label>
            <div class="multi-select-container">
              <div class="multi-select-display" id="type-display">All Types</div>
              <div class="multi-select-dropdown" id="type-dropdown">
                <!-- Options will be populated by JavaScript -->
              </div>
            </div>
          </div>
          <button id="clear-filters" class="btn secondary">Clear All</button>
        </div>
        
        <div class="results-header">
          <div class="results-title-container">
            <h3 id="results-title">Recommended Events</h3>
            <div id="event-count" class="event-count"></div>
          </div>
          <div class="sort-container">
            <label for="sort-select">Sort by:</label>
            <select id="sort-select" class="sort-select">
              <option value="relevance">Relevance</option>
              <option value="date">Date</option>
              <option value="time">Time</option>
              <option value="name">Name</option>
            </select>
          </div>
        </div>
        
        <div id="ai-reasoning" class="ai-reasoning" hidden>
          <div id="reasoning-content"></div>
        </div>
        
        <div id="events"></div>
      </div>
      
      <!-- Floating Outfit Button -->
      <button id="outfit-btn" class="btn primary floating-outfit-btn" hidden>
        Get Outfit Ideas
      </button>
      
      <!-- Email Collection Modal -->
      <div id="email-modal" class="modal-overlay show" style="z-index: 9999;">
        <div class="modal-content" style="max-width: 500px;">
          <div class="modal-header">
            <h3 class="modal-title">Welcome to Tech Week Wizard by Shezaar!</h3>
          </div>
          
          <div class="email-collection-content">
            <p style="color: #daded8; margin-bottom: 20px; line-height: 1.6;">
              To help us improve your experience and provide better recommendations, 
              please share your email address. We'll only use it to track the search performance.
            </p>
            
            <div class="email-input-group">
              <input 
                type="email" 
                id="user-email" 
                placeholder="Enter your email address"
                style="
                  width: 100%;
                  padding: 16px 20px;
                  border: 2px solid rgba(218, 222, 216, 0.3);
                  border-radius: 8px;
                  background: rgba(44, 52, 36, 0.8);
                  color: #daded8;
                  font-size: 16px;
                  margin-bottom: 20px;
                  transition: border-color 0.3s ease;
                "
              >
              <div class="modal-actions" style="justify-content: center;">
                <button id="skip-email" class="btn tertiary">Skip for now</button>
                <button id="submit-email" class="btn primary">Continue</button>
              </div>
            </div>
            
            <p style="color: rgba(218, 222, 216, 0.7); font-size: 12px; text-align: center; margin-top: 20px;">
              By continuing, you agree to our 
              <a href="/privacy-policy.html" target="_blank" style="color: #daded8;">Privacy Policy</a> 
              and 
              <a href="/terms-of-use.html" target="_blank" style="color: #daded8;">Terms of Use</a>
            </p>
          </div>
        </div>
      </div>

      <!-- Outfit Recommendation Modal -->
      <div id="outfit-modal" class="modal-overlay">
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="modal-title">Outfit Ideas</h3>
            <button class="btn secondary modal-close" id="modal-close">&times;</button>
          </div>
          
          <!-- Gender Selection Step -->
          <div id="gender-selection" class="gender-selection">
            <h4>Select your gender to get personalized outfit recommendations:</h4>
            <div class="gender-options">
              <button class="btn secondary gender-btn" data-gender="female">Female</button>
              <button class="btn secondary gender-btn" data-gender="male">Male</button>
              <button class="btn secondary gender-btn" data-gender="prefer-not-to-say">Prefer not to say</button>
            </div>
          </div>
          
          <!-- Outfit Recommendations Content -->
          <div id="outfit-content" class="outfit-content" style="display: none;">
            <!-- Outfit recommendation content will be inserted here -->
          </div>
          
          <!-- Products Display -->
          <div id="products-content" class="products-content" style="display: none;">
            <h4>Shop For Products</h4>
            <div id="products-list"></div>
          </div>
          
          <div class="modal-actions">
            <button class="btn primary" id="shop-products-btn" style="display: none;">Shop For Products</button>
            <button class="btn tertiary" id="get-another-outfit" style="display: none;">Another Recommendation</button>
          </div>
        </div>
      </div>
      
      <footer class="footer">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
          <p style="margin: 0;">Powered by the minds behind <a href="https://www.shezaar.com" target="_blank" rel="noopener" class="shezaar-link">Shezaar</a></p>
          <div style="display: flex; gap: 20px;">
            <a href="/privacy-policy.html" target="_blank" style="color: rgba(218, 222, 216, 0.8); text-decoration: none; transition: color 0.3s ease;">Privacy Policy</a>
            <a href="/terms-of-use.html" target="_blank" style="color: rgba(218, 222, 216, 0.8); text-decoration: none; transition: color 0.3s ease;">Terms of Use</a>
          </div>
        </div>
      </footer>
    </div>

    <script>
      const $ = (id) => document.getElementById(id);
      const btn = $('go');
      const outfitBtn = $('outfit-btn');
      const input = $('input');
      const status = $('status');
      const out = $('out');
      const filtersEl = $('filters');
      const eventsEl = $('events');
      const dayDisplay = $('day-display');
      const dayDropdown = $('day-dropdown');
      const locationDisplay = $('location-display');
      const locationDropdown = $('location-dropdown');
      const industryDisplay = $('industry-display');
      const industryDropdown = $('industry-dropdown');
      const typeDisplay = $('type-display');
      const typeDropdown = $('type-dropdown');
      const sortSelect = $('sort-select');
      const clearFiltersBtn = $('clear-filters');
      console.log('clearFiltersBtn found:', clearFiltersBtn);
      const aiReasoningEl = $('ai-reasoning');
      const reasoningContentEl = $('reasoning-content');
      const outfitModal = $('outfit-modal');
      const genderSelection = $('gender-selection');
      const outfitContent = $('outfit-content');
      const productsContent = $('products-content');
      const productsList = $('products-list');
      const modalClose = $('modal-close');
      const getAnotherOutfitBtn = $('get-another-outfit');
      const shopProductsBtn = $('shop-products-btn');
      
      // Session tracking variables
      let userSession = {
        email: null,
        sessionId: null,
        startTime: Date.now(),
        interactions: [],
        queries: [],
        buttonClicks: []
      };

      // Generate session ID
      userSession.sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

      // Email modal elements
      const emailModal = $('email-modal');
      const userEmailInput = $('user-email');
      const submitEmailBtn = $('submit-email');
      const skipEmailBtn = $('skip-email');

      // Hide floating button initially
      outfitBtn.hidden = true;

      // Session tracking functions
      function trackInteraction(type, data) {
        console.log('trackInteraction called with:', type, data);
        userSession.interactions.push({
          type: type,
          data: data,
          timestamp: Date.now()
        });
        
        const payload = {
          sessionId: userSession.sessionId,
          email: userSession.email,
          type: type,
          data: data,
          timestamp: Date.now(),
          userAgent: navigator.userAgent
        };
        
        console.log('Sending to API:', payload);
        
        // Send to analytics endpoint (optional)
        fetch('/api/log-interaction', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        })
        .then(response => {
          console.log('API response status:', response.status);
          return response.json();
        })
        .then(result => {
          console.log('API response data:', result);
        })
        .catch(err => console.log('Analytics tracking failed:', err));
      }

      function trackQuery(query) {
        userSession.queries.push({
          query: query,
          timestamp: Date.now()
        });
        trackInteraction('search_query', { query: query });
      }

      function trackButtonClick(buttonId, buttonText) {
        userSession.buttonClicks.push({
          buttonId: buttonId,
          buttonText: buttonText,
          timestamp: Date.now()
        });
        trackInteraction('button_click', { buttonId: buttonId, buttonText: buttonText });
      }

      // Email modal functions
      function hideEmailModal() {
        emailModal.classList.remove('show');
      }

      function handleEmailSubmission() {
        const email = userEmailInput.value.trim();
        console.log('Email submission attempt:', email);
        if (email && email.includes('@')) {
          userSession.email = email;
          console.log('Tracking email provided:', email);
          trackInteraction('email_provided', { email: email });
          hideEmailModal();
        } else if (email) {
          alert('Please enter a valid email address');
          return;
        }
      }

      function handleEmailSkip() {
        console.log('Email skipped - tracking interaction');
        trackInteraction('email_skipped', {});
        hideEmailModal();
      }

      // Email modal event listeners
      submitEmailBtn.addEventListener('click', handleEmailSubmission);
      skipEmailBtn.addEventListener('click', handleEmailSkip);
      
      userEmailInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          handleEmailSubmission();
        }
      });

      // Track when user closes email modal by clicking outside
      emailModal.addEventListener('click', (e) => {
        if (e.target === emailModal) {
          handleEmailSkip();
        }
      });
      
      // Ensure floating button is always visible and properly positioned
      function ensureFloatingButtonVisibility() {
        if (!outfitBtn.hidden) {
          // Force the button to be visible and positioned correctly
          outfitBtn.style.position = 'fixed';
          outfitBtn.style.bottom = '20px';
          outfitBtn.style.right = '20px';
          outfitBtn.style.zIndex = '1000';
          outfitBtn.style.pointerEvents = 'auto';
          outfitBtn.disabled = false; // Ensure button is not disabled
          
          // Adjust for mobile screens
          if (window.innerWidth <= 768) {
            outfitBtn.style.bottom = '16px';
            outfitBtn.style.right = '16px';
          }
          if (window.innerWidth <= 480) {
            outfitBtn.style.bottom = '12px';
            outfitBtn.style.right = '12px';
          }
          if (window.innerWidth <= 360) {
            outfitBtn.style.bottom = '10px';
            outfitBtn.style.right = '10px';
          }
        }
      }
      
      // Call on window resize
      window.addEventListener('resize', ensureFloatingButtonVisibility);
      
      // Call initially
      ensureFloatingButtonVisibility();
      
      let allEvents = [];
      let filteredEvents = [];
      let aiReasoning = null;
      let selectedDays = [];
      let selectedLocations = [];
      let selectedIndustries = [];
      let selectedTypes = [];

      // Function to log user interactions to Supabase
      async function logInteraction(type, data) {
        try {
          await fetch('/api/log-interaction', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              type: type, // 'query', 'find_events', 'find_outfit'
              data: data,
              timestamp: new Date().toISOString(),
              userAgent: navigator.userAgent
            })
          });
        } catch (error) {
          console.error('Failed to log interaction:', error);
        }
      }

      async function recommend() {
        const message = input.value.trim();
        if (!message) return;
        
        // Log the query and button click
        await logInteraction('query', { message });
        await logInteraction('find_events', { message });
        
        // Track user session
        trackQuery(message);
        trackButtonClick('go', 'Find Events');
        
        btn.disabled = true; status.innerHTML = '<div class="loading"></div> Finding the best events for you...';
        out.hidden = true; eventsEl.innerHTML = ''; filtersEl.hidden = true;
        outfitBtn.hidden = true; // Hide floating button during search
        try {
          const resp = await fetch('/api/recommend-events', {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message, limit: 1000 })
          });
          const data = await resp.json();
          if (!data.ok) throw new Error(data.error || 'Failed');
          
          allEvents = data.results || [];
          filteredEvents = [...allEvents];
          aiReasoning = data.aiReasoning || null;
          
          if (allEvents.length > 0) {
            // Populate filter options
            populateFilters(allEvents);
            // Show filters and results
            filtersEl.hidden = false;
            renderEvents();
            renderAIReasoning();
            
            // Update results title to show recommended events
            const resultsTitle = $('results-title');
            if (resultsTitle) {
              resultsTitle.textContent = 'Recommended Events';
            }
            
            // Show floating outfit button
            outfitBtn.hidden = false;
            outfitBtn.disabled = false; // Ensure button is enabled
            ensureFloatingButtonVisibility();
          } else {
            eventsEl.innerHTML = `
              <div class="event">
                <div class="event-title">No Events Found</div>
                <div class="event-meta">
                  <span>${data.message || 'Try adjusting your search criteria or check back later for new events.'}</span>
                </div>
              </div>
            `;
          }
          
          out.hidden = false;
        } catch (e) {
          console.error('Error:', e);
          status.innerHTML = `<div class="error">Error: ${e.message}</div>`;
        } finally {
          btn.disabled = false; 
          if (!status.innerHTML.includes('error')) {
            status.textContent = '';
          }
        }
      }

      async function recommendOutfit() {
        const message = input.value.trim();
        if (!message) return;
        
        // Log the query and outfit button click
        await logInteraction('query', { message });
        await logInteraction('find_outfit', { message });
        
        // Show modal with gender selection
        showGenderSelection();
      }
      
      function showGenderSelection() {
        // Reset modal state
        genderSelection.style.display = 'block';
        outfitContent.style.display = 'none';
        productsContent.style.display = 'none';
        getAnotherOutfitBtn.style.display = 'none';
        shopProductsBtn.style.display = 'none';
        
        // Show modal
        outfitModal.classList.add('show');
        document.body.style.overflow = 'hidden';
      }
      
      async function getOutfitRecommendations(gender) {
        const message = input.value.trim();
        if (!message) return;
        
        outfitBtn.disabled = true; 
        status.innerHTML = '<div class="loading"></div> Finding the perfect outfit for you...';
        
        try {
          // Prepare current events data to send to the API
          const currentEventsData = allEvents.map(event => ({
            event_category: event.event_category || 'General',
            name: event.name,
            description: event.description
          }));
          
          const resp = await fetch('/api/recommend-outfit', {
            method: 'POST', 
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message, gender, currentEvents: currentEventsData })
          });
          const data = await resp.json();
          if (!data.ok) throw new Error(data.error || 'Failed');
          
          // Display outfit recommendations in modal
          showOutfitRecommendations(data);
          
        } catch (e) {
          console.error('Error:', e);
          status.innerHTML = `<div class="error">Error: ${e.message}</div>`;
        } finally {
          outfitBtn.disabled = false; 
          if (!status.innerHTML.includes('error')) {
            status.textContent = '';
          }
        }
      }
      
      // Global variables for outfit recommendation navigation
      let currentOutfitIndex = 0;
      let allOutfitRecommendations = [];

      function showOutfitRecommendations(data) {
        const eventCategories = data.eventCategories || [];
        const outfitRecommendations = data.outfitRecommendations || [];
        const tabs = data.tabs || [];
        
        // Store event categories globally for navigation
        window.currentEventCategories = eventCategories;
        
        // Hide gender selection and show outfit content
        genderSelection.style.display = 'none';
        outfitContent.style.display = 'block';
        getAnotherOutfitBtn.style.display = 'inline-block';
        shopProductsBtn.style.display = 'inline-block';
        
        // Use tabs if available, otherwise fall back to outfitRecommendations
        if (tabs.length > 0) {
          allOutfitRecommendations = tabs;
          currentOutfitIndex = 0;
          // Show tabbed interface
          showTabbedOutfitRecommendations(tabs, eventCategories);
        } else if (outfitRecommendations.length > 0) {
          allOutfitRecommendations = outfitRecommendations;
          currentOutfitIndex = 0;
          // Show the first recommendation (legacy format)
          showCurrentOutfitRecommendation(eventCategories);
        } else {
          // Create a fallback recommendation object
          allOutfitRecommendations = [{
            event_category: 'General',
            outfit_recommendation: data.recommendation || 'No outfit recommendation available.',
            reasoning: data.reasoning || ''
          }];
          currentOutfitIndex = 0;
          showCurrentOutfitRecommendation(eventCategories);
        }
      }

      function showTabbedOutfitRecommendations(tabs, eventCategories) {
        if (tabs.length === 0) return;
        
        // Create tab navigation
        const tabNavigation = tabs.map((tab, index) => {
          // Format tab name: capitalize first letter and replace hyphens with spaces
          const formattedName = tab.event_category
            .split('-')
            .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
            .join(' ');
          
          return `
            <button class="outfit-tab ${index === 0 ? 'active' : ''}" data-tab-index="${index}">
              ${formattedName}
            </button>
          `;
        }).join('');
        
        // Create tab content
        const tabContent = tabs.map((tab, index) => `
          <div class="outfit-tab-content ${index === 0 ? 'active' : ''}" data-tab-index="${index}">
            <div class="outfit-recommendation">
              <p><strong>Outfit:</strong> ${tab.outfit_recommendation}</p>
              <p><strong>Why this outfit:</strong> ${tab.reasoning}</p>
            </div>
          </div>
        `).join('');
        
        outfitContent.innerHTML = `
          <div class="outfit-tabs-container">
            <div class="outfit-tabs-navigation">
              ${tabNavigation}
            </div>
            <div class="outfit-tabs-content">
              ${tabContent}
            </div>
          </div>
        `;
        
        // Add event listeners to tabs
        outfitContent.querySelectorAll('.outfit-tab').forEach(tab => {
          tab.addEventListener('click', (e) => {
            const tabIndex = parseInt(e.target.dataset.tabIndex);
            switchTab(tabIndex);
          });
        });
      }

      function showCurrentOutfitRecommendation(eventCategories) {
        if (allOutfitRecommendations.length === 0) return;
        
        const currentRec = allOutfitRecommendations[currentOutfitIndex];
        
        outfitContent.innerHTML = `
          <div class="outfit-recommendation">
            <p><strong>Outfit:</strong> ${currentRec.outfit_recommendation}</p>
            <p><strong>Why this outfit:</strong> ${currentRec.reasoning}</p>
          </div>
        `;
      }

      function switchTab(tabIndex) {
        // Remove active class from all tabs and content
        outfitContent.querySelectorAll('.outfit-tab').forEach(tab => tab.classList.remove('active'));
        outfitContent.querySelectorAll('.outfit-tab-content').forEach(content => content.classList.remove('active'));
        
        // Add active class to selected tab and content
        const selectedTab = outfitContent.querySelector(`[data-tab-index="${tabIndex}"]`);
        const selectedContent = outfitContent.querySelector(`.outfit-tab-content[data-tab-index="${tabIndex}"]`);
        
        if (selectedTab) selectedTab.classList.add('active');
        if (selectedContent) selectedContent.classList.add('active');
        
        // Update current index for navigation
        currentOutfitIndex = tabIndex;
      }

      function showNextOutfitRecommendation() {
        if (allOutfitRecommendations.length <= 1) return;
        
        currentOutfitIndex = (currentOutfitIndex + 1) % allOutfitRecommendations.length;
        
        // Check if we're using tabbed interface
        const hasTabs = outfitContent.querySelector('.outfit-tabs-container');
        if (hasTabs) {
          // Switch to the next tab
          switchTab(currentOutfitIndex);
        } else {
          // Get event categories from the current data (we'll need to store this globally too)
          const eventCategories = window.currentEventCategories || [];
          showCurrentOutfitRecommendation(eventCategories);
        }
      }
      
      async function showProducts() {
        try {
          status.innerHTML = '<div class="loading"></div> Loading products...';
          
          const resp = await fetch('/api/get-products', {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
          });
          
          const data = await resp.json();
          
          if (data.ok && data.products && data.products.length > 0) {
            productsList.innerHTML = `
              <div class="products-grid">
                ${data.products.map(product => `
                  <div class="product-item">
                    <div class="product-name">${product.product_name || 'Product Name'}</div>
                    <div class="product-price">${product.price || 'Price TBA'}</div>
                    ${product.product_url ? `<a href="${product.product_url}" target="_blank" class="product-link">View Product</a>` : ''}
                  </div>
                `).join('')}
              </div>
            `;
          } else {
            productsList.innerHTML = `
              <div class="no-products">
                No products available at the moment. Check back soon!
              </div>
            `;
          }
          
          // Show products content below the outfit recommendation
          productsContent.style.display = 'block';
          shopProductsBtn.style.display = 'none';
          
        } catch (e) {
          console.error('Error loading products:', e);
          productsList.innerHTML = `
            <div class="no-products">
              Error loading products. Please try again later.
            </div>
          `;
          // Still show the products content even if there's an error
          productsContent.style.display = 'block';
          shopProductsBtn.style.display = 'none';
        } finally {
          status.textContent = '';
        }
      }
      
      function hideOutfitModal() {
        outfitModal.classList.remove('show');
        document.body.style.overflow = ''; // Restore scrolling
        
        // Reset modal state
        genderSelection.style.display = 'block';
        outfitContent.style.display = 'none';
        productsContent.style.display = 'none';
        getAnotherOutfitBtn.style.display = 'none';
        shopProductsBtn.style.display = 'none';
        
        // Clear products list
        productsList.innerHTML = '';
        
        // Reset global variables
        currentOutfitIndex = 0;
        allOutfitRecommendations = [];
        window.currentEventCategories = [];
      }
      
      function populateFilters(events) {
        // Populate location filter
        const locations = [...new Set(events.map(e => e.location).filter(Boolean))].sort();
        locationDropdown.innerHTML = locations.map(loc => 
          `<div class="multi-select-option" data-value="${loc}">${loc}</div>`
        ).join('');
        
        // Restore selected states for location filter
        selectedLocations.forEach(loc => {
          const option = locationDropdown.querySelector(`[data-value="${loc}"]`);
          if (option) option.classList.add('selected');
        });
        
        // Populate industry filter from centralized config
        const industryTags = [
          'ai-ml', 'fintech', 'healthtech', 'edtech', 'cybersecurity',
          'blockchain', 'sustainability', 'biotech', 'quantum',
          'enterprise', 'consumer', 'startup', 'media', 'gaming',
          'mobility', 'real-estate', 'legal', 'hr', 'sales', 'marketing',
          'fashion-tech', 'food-tech', 'space', 'robotics'
        ];
        
        industryDropdown.innerHTML = industryTags.map(industry => {
          const displayName = industry.split('-').map(word => 
            word.charAt(0).toUpperCase() + word.slice(1)
          ).join(' ');
          return `<div class="multi-select-option" data-value="${industry}">${displayName}</div>`;
        }).join('');
        
        // Restore selected states for industry filter
        selectedIndustries.forEach(industry => {
          const option = industryDropdown.querySelector(`[data-value="${industry}"]`);
          if (option) option.classList.add('selected');
        });
        
        // Populate type filter from centralized usage tags
        const typeTags = [
          'find-cofounder', 'find-investors', 'find-angels', 'find-talent', 'find-customers',
          'find-advisors', 'find-partners', 'get-feedback', 'learn-skills', 'industry-insights', 'networking',
          'pitch-opportunities', 'fundraising', 'product-launch', 'women-specific'
        ];
        
        typeDropdown.innerHTML = typeTags.map(type => {
          const displayName = type.replace(/-/g, ' ').split(' ').map(word => 
            word.charAt(0).toUpperCase() + word.slice(1)
          ).join(' ');
          return `<div class="multi-select-option" data-value="${type}">${displayName}</div>`;
        }).join('');
        
        // Restore selected states for type filter
        selectedTypes.forEach(type => {
          const option = typeDropdown.querySelector(`[data-value="${type}"]`);
          if (option) option.classList.add('selected');
        });
      }
      
      // Multi-select functionality
      function initializeMultiSelect(display, dropdown, selectedArray, updateDisplay) {
        display.addEventListener('click', (e) => {
          e.stopPropagation();
          const isOpen = dropdown.classList.contains('show');
          
          // Close all other dropdowns
          document.querySelectorAll('.multi-select-dropdown').forEach(dd => {
            dd.classList.remove('show');
            dd.previousElementSibling.classList.remove('open');
          });
          
          if (!isOpen) {
            dropdown.classList.add('show');
            display.classList.add('open');
          }
        });
        
        // Use event delegation - attach to dropdown container instead of individual options
        dropdown.addEventListener('click', (e) => {
          e.stopPropagation();
          const option = e.target.closest('.multi-select-option');
          if (option) {
            const value = option.dataset.value;
            const index = selectedArray.indexOf(value);
            
            if (index > -1) {
              selectedArray.splice(index, 1);
              option.classList.remove('selected');
            } else {
              selectedArray.push(value);
              option.classList.add('selected');
            }
            
            updateDisplay();
            applyFilters();
          }
        });
        
        // Store the selected array and update function for later use when content changes
        dropdown._selectedArray = selectedArray;
        dropdown._updateDisplay = updateDisplay;
      }
      
      function updateDayDisplay() {
        if (selectedDays.length === 0) {
          dayDisplay.textContent = 'All Days';
        } else if (selectedDays.length === 1) {
          dayDisplay.textContent = selectedDays[0];
        } else {
          dayDisplay.textContent = `${selectedDays.length} days selected`;
        }
      }
      
      function updateLocationDisplay() {
        if (selectedLocations.length === 0) {
          locationDisplay.textContent = 'All Locations';
        } else if (selectedLocations.length === 1) {
          locationDisplay.textContent = selectedLocations[0];
        } else {
          locationDisplay.textContent = `${selectedLocations.length} locations selected`;
        }
      }
      
      function updateIndustryDisplay() {
        if (selectedIndustries.length === 0) {
          industryDisplay.textContent = 'All Industries';
        } else if (selectedIndustries.length === 1) {
          const displayName = selectedIndustries[0].split('-').map(word => 
            word.charAt(0).toUpperCase() + word.slice(1)
          ).join(' ');
          industryDisplay.textContent = displayName;
        } else {
          industryDisplay.textContent = `${selectedIndustries.length} industries selected`;
        }
      }
      
      function updateTypeDisplay() {
        if (selectedTypes.length === 0) {
          typeDisplay.textContent = 'All Types';
        } else if (selectedTypes.length === 1) {
          const displayName = selectedTypes[0].replace(/-/g, ' ').split(' ').map(word => 
            word.charAt(0).toUpperCase() + word.slice(1)
          ).join(' ');
          typeDisplay.textContent = displayName;
        } else {
          typeDisplay.textContent = `${selectedTypes.length} types selected`;
        }
      }
      
      
      function applyFilters() {
        filteredEvents = allEvents.filter(event => {
          const dayMatch = selectedDays.length === 0 || 
                          selectedDays.some(day => event.date?.includes(day) || getDayFromDate(event.date) === day);
          const locationMatch = selectedLocations.length === 0 || 
                               selectedLocations.includes(event.location);
          const industryMatch = selectedIndustries.length === 0 || 
                                (event.industry_tags && selectedIndustries.some(industry => event.industry_tags.includes(industry)));
          const typeMatch = selectedTypes.length === 0 || 
                            (event.usage_tags && selectedTypes.some(type => event.usage_tags.includes(type)));
          
          return dayMatch && locationMatch && industryMatch && typeMatch;
        });
        
        // Update results title based on whether filters are applied
        const resultsTitle = $('results-title');
        if (resultsTitle) {
          const hasFilters = selectedDays.length > 0 || selectedLocations.length > 0 || 
                           selectedIndustries.length > 0 || selectedTypes.length > 0;
          resultsTitle.textContent = hasFilters ? 'Filtered Events' : 'All Events';
        }
        
        renderEvents();
      }
      
      function getDayFromDate(dateStr) {
        if (!dateStr) return '';
        const date = new Date(dateStr);
        if (isNaN(date.getTime())) return '';
        return date.toLocaleDateString('en-US', { weekday: 'long' });
      }
      
      function sortEvents() {
        const sortBy = sortSelect.value;
        
        filteredEvents.sort((a, b) => {
          switch (sortBy) {
            case 'date':
              return new Date(a.date || 0) - new Date(b.date || 0);
            case 'time':
              return (a.time || '').localeCompare(b.time || '');
            case 'name':
              return (a.name || '').localeCompare(b.name || '');
            case 'relevance':
            default:
              // Prioritize industry-specific events first
              const aHasIndustryTags = a.industry_tags && a.industry_tags.length > 0;
              const bHasIndustryTags = b.industry_tags && b.industry_tags.length > 0;
              
              // If one has industry tags and the other doesn't, prioritize the one with industry tags
              if (aHasIndustryTags && !bHasIndustryTags) return -1;
              if (!aHasIndustryTags && bHasIndustryTags) return 1;
              
              // If both have industry tags or both don't, sort by date (newest first)
              return new Date(b.date || 0) - new Date(a.date || 0);
          }
        });
        
        renderEvents();
      }
      
      function renderEvents() {
        // Update event count display
        const eventCountEl = document.getElementById('event-count');
        if (eventCountEl) {
          eventCountEl.textContent = `${filteredEvents.length} event${filteredEvents.length !== 1 ? 's' : ''} found`;
        }
        
        if (filteredEvents.length === 0) {
          eventsEl.innerHTML = `
            <div class="event">
              <div class="event-title">No Events Match Your Filters</div>
              <div class="event-meta">
                <span>Try adjusting your filters or clearing them to see more events.</span>
              </div>
            </div>
          `;
          return;
        }
        
        eventsEl.innerHTML = filteredEvents.map(r => `
          <div class="event">
              <div class="event-title">${r.name}</div>
              ${r.description ? `<div class="event-description">${r.description.length > 200 ? r.description.substring(0, 200) + '...' : r.description}</div>` : ''}
              <div class="event-meta">
                <span>📅 ${r.date || 'TBA'}</span>
                <span>🕐 ${r.time || 'TBA'}</span>
                <span>📍 ${r.location || 'TBA'}</span>
                <span>💰 ${r.price || 'TBA'}</span>
              </div>
              <div class="event-host">👤 Host: ${r.host || 'TBA'}</div>
              ${r.tags ? `<div class="event-tags">${r.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}</div>` : ''}
              ${r.aiReason ? `<div class="event-reason"><strong>Why recommended:</strong> ${r.aiReason}</div>` : ''}
              <div><a href="${r.url}" target="_blank" rel="noopener" class="event-link">View details →</a></div>
          </div>
        `).join('');
      }
      
      function clearFilters() {
        console.log('clearFilters called');
        console.log('Before clear - selectedDays:', selectedDays);
        console.log('Before clear - selectedLocations:', selectedLocations);
        console.log('Before clear - allEvents length:', allEvents.length);
        
        // Clear selected filters
        selectedDays = [];
        selectedLocations = [];
        selectedIndustries = [];
        selectedTypes = [];
        
        // Clear query input
        input.value = '';
        
        // Reset sort
        sortSelect.value = 'relevance';
        
        // Clear multi-select displays
        updateDayDisplay();
        updateLocationDisplay();
        updateIndustryDisplay();
        updateTypeDisplay();
        
        // Clear selected states in dropdowns
        document.querySelectorAll('.multi-select-option').forEach(option => {
          option.classList.remove('selected');
        });
        
        // Close all dropdowns
        document.querySelectorAll('.multi-select-dropdown').forEach(dd => {
          dd.classList.remove('show');
          dd.previousElementSibling.classList.remove('open');
        });
        
         // Fetch ALL events from database (reset query logic)
         console.log('Fetching all events from database...');
         fetch('/api/get-events?limit=2000')
           .then(response => {
             console.log('Fetch response:', response.status);
             return response.json();
           })
           .then(data => {
             console.log('Fetch data:', data);
             if (data.ok && data.events) {
               // Transform events to match the expected format
               allEvents = data.events.map(event => ({
                 id: event.id,
                 name: event.event_name,
                 description: event.event_description,
                 date: event.event_date,
                 time: event.event_time,
                 location: event.event_location,
                 host: event.hosted_by,
                 price: event.price,
                 url: event.event_url,
                 tags: event.event_tags,
                 usage_tags: event.usage_tags,
                 industry_tags: event.industry_tags,
                 women_specific: event.women_specific,
                 invite_only: event.invite_only,
                 event_category: event.event_category
               }));
               
               filteredEvents = [...allEvents];
               console.log('Updated allEvents length:', allEvents.length);
               populateFilters(allEvents);
               
               // Update results title to show all events
               const resultsTitle = $('results-title');
               if (resultsTitle) {
                 resultsTitle.textContent = 'All Events';
               }
               
               // Hide AI reasoning when showing all events
               if (aiReasoningEl) {
                 aiReasoningEl.hidden = true;
               }
               
               // Re-render events
               renderEvents();
               
               console.log('clearFilters completed, fetched', filteredEvents.length, 'events from database');
             } else {
               console.error('Failed to fetch all events:', data.error);
               // Fallback to current events if fetch fails
               filteredEvents = [...allEvents];
               renderEvents();
             }
           })
           .catch(error => {
             console.error('Error fetching all events:', error);
             // Fallback to current events if fetch fails
             filteredEvents = [...allEvents];
             renderEvents();
           });
      }
      
      function renderAIReasoning() {
        if (!aiReasoning || !aiReasoning.overall) {
          aiReasoningEl.hidden = true;
          return;
        }
        
        // Extract industry focus from the reasoning
        let industryFocus = 'fashion technology'; // default
        if (aiReasoning.relevance_suggestions && aiReasoning.relevance_suggestions.primary_criteria) {
          const primaryCriteria = aiReasoning.relevance_suggestions.primary_criteria;
          if (Array.isArray(primaryCriteria) && primaryCriteria.length > 0) {
            // Look for industry-specific terms in the primary criteria
            const industryMatch = primaryCriteria.find(criteria => 
              criteria.toLowerCase().includes('fashion') || 
              criteria.toLowerCase().includes('industry')
            );
            if (industryMatch) {
              // Extract industry name from the criteria
              if (industryMatch.toLowerCase().includes('fashion')) {
                industryFocus = 'fashion technology';
              } else if (industryMatch.toLowerCase().includes('ai')) {
                industryFocus = 'artificial intelligence';
              } else if (industryMatch.toLowerCase().includes('fintech')) {
                industryFocus = 'fintech';
              } else if (industryMatch.toLowerCase().includes('health')) {
                industryFocus = 'health technology';
              }
            }
          }
        }
        
        // Extract goals from the reasoning
        let goalText = '';
        if (aiReasoning.relevance_suggestions && aiReasoning.relevance_suggestions.primary_criteria) {
          const primaryCriteria = aiReasoning.relevance_suggestions.primary_criteria;
          if (Array.isArray(primaryCriteria) && primaryCriteria.length > 0) {
            const criteriaText = primaryCriteria.join(' ').toLowerCase();
            
            // Check for specific goals
            if (criteriaText.includes('cofounder') || criteriaText.includes('co-founder')) {
              goalText = ' in which you can find potential cofounders';
            } else if (criteriaText.includes('networking') || criteriaText.includes('meet people')) {
              goalText = ' for networking opportunities';
            } else if (criteriaText.includes('learn') || criteriaText.includes('learning')) {
              goalText = ' for learning and skill development';
            } else if (criteriaText.includes('investor') || criteriaText.includes('funding')) {
              goalText = ' to connect with investors';
            } else if (criteriaText.includes('partner') || criteriaText.includes('collaboration')) {
              goalText = ' for business partnerships';
            } else if (criteriaText.includes('feedback') || criteriaText.includes('advice')) {
              goalText = ' to get feedback and advice';
            }
          }
        }
        
        // Extract time preferences from the reasoning
        let timeText = '';
        if (aiReasoning.relevance_suggestions && aiReasoning.relevance_suggestions.secondary_criteria) {
          const secondaryCriteria = aiReasoning.relevance_suggestions.secondary_criteria;
          if (Array.isArray(secondaryCriteria) && secondaryCriteria.length > 0) {
            const criteriaText = secondaryCriteria.join(' ').toLowerCase();
            
            // Look for date patterns
            const dateMatch = criteriaText.match(/(before|after|on)\s+(\d{1,2}(?:st|nd|rd|th)?\s+(?:jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)[a-z]*)/i);
            if (dateMatch) {
              const dateStr = dateMatch[2];
              const prefix = dateMatch[1];
              timeText = ` ${prefix} ${dateStr}`;
            } else if (criteriaText.includes('morning')) {
              timeText = ' in the morning';
            } else if (criteriaText.includes('afternoon')) {
              timeText = ' in the afternoon';
            } else if (criteriaText.includes('evening')) {
              timeText = ' in the evening';
            } else if (criteriaText.includes('weekend')) {
              timeText = ' on weekends';
            } else if (criteriaText.includes('weekday')) {
              timeText = ' on weekdays';
            }
          }
        }
        
        // Build the dynamic message
        let message = `We are showing you events for ${industryFocus}`;
        if (goalText) {
          message += goalText;
        }
        if (timeText) {
          message += timeText;
        }
        message += '.';
        
        reasoningContentEl.innerHTML = `
          <div class="reasoning-content">
            ${message}
          </div>
        `;
        aiReasoningEl.hidden = false;
      }

      btn.addEventListener('click', recommend);
      outfitBtn.addEventListener('click', (e) => {
        console.log('Outfit button clicked!', e);
        console.log('Button disabled?', outfitBtn.disabled);
        console.log('Button hidden?', outfitBtn.hidden);
        trackButtonClick('outfit-btn', 'Get Outfit Ideas');
        recommendOutfit();
      });
      input.addEventListener('keydown', (e) => { if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) recommend(); });
      
      // Gender selection event listeners
      document.querySelectorAll('.gender-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          trackButtonClick('gender-btn', e.target.dataset.gender);
          // Remove selected class from all buttons
          document.querySelectorAll('.gender-btn').forEach(b => b.classList.remove('selected'));
          // Add selected class to clicked button
          e.target.classList.add('selected');
          // Get outfit recommendations with selected gender
          getOutfitRecommendations(e.target.dataset.gender);
        });
      });
      
      // Modal event listeners
      modalClose.addEventListener('click', hideOutfitModal);
      getAnotherOutfitBtn.addEventListener('click', () => {
        trackButtonClick('get-another-outfit', 'Another Recommendation');
        showNextOutfitRecommendation();
      });
      shopProductsBtn.addEventListener('click', () => {
        trackButtonClick('shop-products-btn', 'Shop For Products');
        showProducts();
      });
      
      // Close modal when clicking outside
      outfitModal.addEventListener('click', (e) => {
        if (e.target === outfitModal) {
          hideOutfitModal();
        }
      });
      
      // Close modal with Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && outfitModal.classList.contains('show')) {
          hideOutfitModal();
        }
      });
      
      // Initialize multi-select components
      initializeMultiSelect(dayDisplay, dayDropdown, selectedDays, updateDayDisplay);
      initializeMultiSelect(locationDisplay, locationDropdown, selectedLocations, updateLocationDisplay);
      initializeMultiSelect(industryDisplay, industryDropdown, selectedIndustries, updateIndustryDisplay);
      initializeMultiSelect(typeDisplay, typeDropdown, selectedTypes, updateTypeDisplay);
      
      // Close dropdowns when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.multi-select-container')) {
          document.querySelectorAll('.multi-select-dropdown').forEach(dd => {
            dd.classList.remove('show');
            dd.previousElementSibling.classList.remove('open');
          });
        }
      });
      
      // Filter and sort event listeners
      sortSelect.addEventListener('change', sortEvents);
      
      // Add Clear All button event listener with error handling
      if (clearFiltersBtn) {
        console.log('Adding event listener to Clear All button');
        clearFiltersBtn.addEventListener('click', () => {
          console.log('Clear All button clicked!');
          trackButtonClick('clear-filters', 'Clear All');
          clearFilters();
        });
      } else {
        console.error('Clear All button not found!');
      }
    </script>
  </body>
  </html>

